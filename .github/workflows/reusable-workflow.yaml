name: Demo Reusable Workflow

on:
  workflow_call:
    inputs:
      run_build:
        required: true
        type: string
      run_sonar:
        required: true
        type: string
      run_deploy:
        required: true
        type: string
      run_archive:
        required: true
        type: string

jobs:

  # --------------------
  # Conditions job
  # --------------------
  conditions:
    name: Conditions
    uses: ./.github/workflows/set-conditions.yaml
    with:
      run_build: ${{ inputs.run_build }}
      run_sonar: ${{ inputs.run_sonar }}
      run_deploy: ${{ inputs.run_deploy }}
      run_archive: ${{ inputs.run_archive }}

  # --------------------
  # Build job
  # --------------------
  build:
    name: Build
    needs: conditions
    if: needs.conditions.outputs.enable_build == 'true'
    runs-on: ubuntu-latest
    steps:
      - run: echo "üèóÔ∏è Build job running"

  # --------------------
  # Sonar
  # --------------------
  sonar:
    name: Sonar
    needs: conditions
    if: needs.conditions.outputs.enable_sonar == 'true'
    runs-on: ubuntu-latest
    steps:
       - run: echo "Sonar job running"
        
  # --------------------
  # Deploy
  # --------------------
  deploy:
    name: Deploy
    needs: [conditions, build]
    if: needs.conditions.outputs.enable_deploy == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Deploy step
        run: echo "üöÄ Deploying application"

# --------------------
  # Archive
  # --------------------
  archive:
    name: Archive
    needs: [conditions, build]
    if: needs.conditions.outputs.enable_archive == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Deploy step
        run: echo "Archive Job running"
